

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>utils.manager.log_manager &mdash; RMI 360 Imaging Workflow v1.1.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=a34f1657"></script>
      <script src="../../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            RMI 360 Imaging Workflow
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../user-guide/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user-guide/configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user-guide/quick-start.html">Quick Start Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user-guide/arcgis-setup.html">ArcGIS Pro Setup</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tools Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/overview.html">Tools Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api/tools.html">Tools API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/utils.html">Utilities API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/managers.html">Managers API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/validators.html">Validators API Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980B9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">RMI 360 Imaging Workflow</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">utils.manager.log_manager</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for utils.manager.log_manager</h1><div class="highlight"><pre>
<span></span><span class="c1"># =============================================================================</span>
<span class="c1"># üóæ Log Manager Utility (utils/manager/log_manager.py)</span>
<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># Purpose:             Provides structured logging across CLI, ArcGIS, and web output.</span>
<span class="c1"># Project:             RMI 360 Imaging Workflow Python Toolbox</span>
<span class="c1"># Version:             1.1.0</span>
<span class="c1"># Author:              RMI Valuation, LLC</span>
<span class="c1"># Created:             2025-05-11</span>
<span class="c1"># Last Updated:        2025-05-20</span>
<span class="c1">#</span>
<span class="c1"># Description:</span>
<span class="c1">#   Centralized logging framework that supports text, HTML, and JSON output.</span>
<span class="c1">#   Includes step-based indentation, duration tracking, context metadata, and</span>
<span class="c1">#   optional &quot;celebration&quot; features. Designed to support both ArcPy tools and</span>
<span class="c1">#   CLI pipelines. Compatible with PathManager for output directory control.</span>
<span class="c1">#</span>
<span class="c1"># File Location:        /utils/manager/log_manager.py</span>
<span class="c1"># Called By:            Tools, orchestrators, testing pipelines</span>
<span class="c1"># Int. Dependencies:    utils/manager/path_manager</span>
<span class="c1"># Ext. Dependencies:    json, time, html, contextlib, typing, datetime</span>
<span class="c1">#</span>
<span class="c1"># Documentation:</span>
<span class="c1">#   See: docs_legacy/LOG_MANAGER.md</span>
<span class="c1">#   (Ensure this doc is current; update if needed.)</span>
<span class="c1">#</span>
<span class="c1"># Notes:</span>
<span class="c1">#   - HTML logs are collapsible with toggleable timestamps.</span>
<span class="c1">#   - JSON output includes metadata for downstream automation.</span>
<span class="c1">#   - Supports playful methods like .party(), .fireworks(), and .success().</span>
<span class="c1">#   - Integrates with PathManager for file output and log organization.</span>
<span class="c1"># =============================================================================</span>

<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Dict</span>
<span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">contextmanager</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">html</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">utils.manager.path_manager</span> <span class="kn">import</span> <span class="n">PathManager</span>

<div class="viewcode-block" id="LogManager">
<a class="viewcode-back" href="../../../api/managers.html#utils.manager.log_manager.LogManager">[docs]</a>
<span class="k">class</span> <span class="nc">LogManager</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    LogManager provides structured logging for command-line, ArcGIS, and web-based workflows.</span>

<span class="sd">    Logs are collected in plain text, HTML, and JSON formats with support for:</span>
<span class="sd">    - Multiple log levels (info, warning, error, debug)</span>
<span class="sd">    - Step-based indentation and timing</span>
<span class="sd">    - Context metadata (tool, file, reel, etc.)</span>
<span class="sd">    - ArcGIS Pro messaging (if a message object is provided)</span>
<span class="sd">    - Export to .txt, .html, and .json files via PathManager</span>

<span class="sd">    Designed for use in orchestration scripts, CLI tools, and ArcGIS Python Toolbox tools.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">LEVEL_PREFIX</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;debug&quot;</span><span class="p">:</span> <span class="s2">&quot;üõ†Ô∏è&quot;</span><span class="p">,</span>
        <span class="s2">&quot;info&quot;</span><span class="p">:</span> <span class="s2">&quot;‚ÑπÔ∏è&quot;</span><span class="p">,</span>
        <span class="s2">&quot;warning&quot;</span><span class="p">:</span> <span class="s2">&quot;‚ö†Ô∏è&quot;</span><span class="p">,</span>
        <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;‚ùå&quot;</span><span class="p">,</span>
        <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="s2">&quot;‚úÖ&quot;</span><span class="p">,</span>
        <span class="s2">&quot;custom&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>  <span class="c1"># Emoji passed as parameter</span>
    <span class="p">}</span>
    <span class="c1"># When True, show [indent] after emoji in log output if debug_messages is True</span>
    <span class="n">SHOW_INDENT_LEVEL_IN_DEBUG</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="c1"># When True, show context in log output if debug_messages is True</span>
    <span class="n">SHOW_CONTEXT_IN_DEBUG</span> <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="LogManager.__init__">
<a class="viewcode-back" href="../../../api/managers.html#utils.manager.log_manager.LogManager.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">messages</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">path_manager</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PathManager</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">enable_file_output</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the LogManager.</span>

<span class="sd">        Args:</span>
<span class="sd">            messages (optional): ArcPy messaging object for integrated tool messages.</span>
<span class="sd">            config (dict, optional): Project-level configuration, including debug flag.</span>
<span class="sd">            path_manager (PathManager, optional): Provides log file directories.</span>
<span class="sd">            enable_file_output (bool): If True, log to .txt, .html, and .json files.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">messages</span> <span class="o">=</span> <span class="n">messages</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path_manager</span> <span class="o">=</span> <span class="n">path_manager</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable_file_output</span> <span class="o">=</span> <span class="n">enable_file_output</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">html_blocks</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indent_char</span> <span class="o">=</span> <span class="s2">&quot;    &quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timing_stack</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_context_stack</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span></div>


<div class="viewcode-block" id="LogManager.log">
<a class="viewcode-back" href="../../../api/managers.html#utils.manager.log_manager.LogManager.log">[docs]</a>
    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;info&quot;</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">error_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">emoji</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Log a message with a specified level, optional context, and explicit indentation.</span>

<span class="sd">        Args:</span>
<span class="sd">            msg (str): The message to log.</span>
<span class="sd">            level (str): Logging level. One of &#39;debug&#39;, &#39;info&#39;, &#39;warning&#39;, &#39;error&#39;, &#39;success&#39;, or &#39;custom&#39;.</span>
<span class="sd">            context (dict, optional): Metadata context to include in the log (default: None).</span>
<span class="sd">            indent (int, optional): Indentation level (number of indent units, default: 0).</span>
<span class="sd">            error_type (Type[Exception], optional): Exception type to raise if level is &#39;error&#39; (default: None).</span>
<span class="sd">            emoji (str, optional): Emoji to use for &#39;custom&#39; level messages (default: None).</span>

<span class="sd">        For &#39;custom&#39; level, provide an emoji.</span>
<span class="sd">        For &#39;error&#39;, if error_type is given, raises after logging (indent forced to 0 unless overridden).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">valid_levels</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="s2">&quot;info&quot;</span><span class="p">,</span> <span class="s2">&quot;warning&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span> <span class="s2">&quot;custom&quot;</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">level</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_levels</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ö†Ô∏è Invalid log level &#39;</span><span class="si">{</span><span class="n">level</span><span class="si">}</span><span class="s2">&#39; (defaulting to info)&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span><span class="p">)</span>
            <span class="n">level</span> <span class="o">=</span> <span class="s2">&quot;info&quot;</span>

        <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="s2">&quot;debug&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;debug_messages&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="c1"># Use context from stack if not provided</span>
        <span class="k">if</span> <span class="n">context</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_context_stack</span><span class="p">:</span>
            <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_context_stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># For custom, emoji must be provided</span>
        <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="s2">&quot;custom&quot;</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="n">emoji</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">LEVEL_PREFIX</span><span class="p">[</span><span class="s2">&quot;custom&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">LEVEL_PREFIX</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="c1"># Add indent level in debug mode if enabled</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;debug_messages&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">SHOW_INDENT_LEVEL_IN_DEBUG</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2"> [</span><span class="si">{</span><span class="n">indent</span><span class="si">}</span><span class="s2">]&quot;</span>

        <span class="n">context_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">context</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;debug_messages&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">SHOW_CONTEXT_IN_DEBUG</span><span class="p">:</span>
                <span class="n">context_str</span> <span class="o">=</span> <span class="s2">&quot;  &quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

        <span class="n">indent_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indent_char</span> <span class="o">*</span> <span class="n">indent</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
        <span class="n">iso_timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
        <span class="n">full_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">indent_str</span><span class="si">}{</span><span class="n">msg</span><span class="si">}{</span><span class="n">context_str</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">full_msg</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">iso_timestamp</span><span class="p">,</span>
            <span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="n">level</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">msg</span><span class="p">,</span>
            <span class="s2">&quot;indent&quot;</span><span class="p">:</span> <span class="n">indent</span><span class="p">,</span>
            <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="n">context</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="p">})</span>

        <span class="n">css_class</span> <span class="o">=</span> <span class="n">level</span>
        <span class="c1"># Enhanced HTML log generation for indentation and collapsibility</span>
        <span class="c1"># Use &lt;details&gt;/&lt;summary&gt; for steps (indent=0 with separator), .block for indented messages</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_open_details&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_open_details</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">html_line</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">indent</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">40</span> <span class="ow">or</span> <span class="p">(</span><span class="n">level</span> <span class="o">==</span> <span class="s1">&#39;custom&#39;</span> <span class="ow">and</span> <span class="n">emoji</span> <span class="o">==</span> <span class="s1">&#39;‚ñ∂Ô∏è&#39;</span><span class="p">)):</span>
            <span class="c1"># Start or end of a step, use &lt;details&gt;/&lt;summary&gt;</span>
            <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">40</span><span class="p">:</span>
                <span class="c1"># Separator, close previous &lt;details&gt; if open</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_details</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">html_blocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;/div&gt;&lt;/details&gt;&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_open_details</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Start a new collapsible block for the step</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_details</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">html_blocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;/div&gt;&lt;/details&gt;&#39;</span><span class="p">)</span>
                <span class="n">summary</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">msg</span> <span class="o">+</span> <span class="p">(</span><span class="n">context_str</span> <span class="k">if</span> <span class="n">context_str</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">html_blocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;details open&gt;&lt;summary&gt;&lt;span class=&quot;ts&quot;&gt;[</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s1">]&lt;/span&gt; </span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">summary</span><span class="si">}</span><span class="s1">&lt;/summary&gt;&lt;div class=&quot;block&quot;&gt;&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_open_details</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># Do not add the separator/step message as a normal line</span>
            <span class="n">html_line</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">block_class</span> <span class="o">=</span> <span class="s1">&#39;block&#39;</span> <span class="k">if</span> <span class="n">indent</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
            <span class="n">html_line</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&lt;div class=&quot;</span><span class="si">{</span><span class="n">css_class</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">block_class</span><span class="si">}</span><span class="s1">&quot;&gt;&lt;span class=&quot;ts&quot;&gt;[</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s1">]&lt;/span&gt; </span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">msg</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">context_str</span><span class="p">)</span><span class="si">}</span><span class="s1">&lt;/div&gt;&#39;</span>
        <span class="k">if</span> <span class="n">html_line</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">html_blocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">html_line</span><span class="p">)</span>


        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="s2">&quot;warning&quot;</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="p">,</span> <span class="s2">&quot;addWarningMessage&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">addWarningMessage</span><span class="p">(</span><span class="n">full_msg</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">level</span> <span class="o">==</span> <span class="s2">&quot;error&quot;</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="p">,</span> <span class="s2">&quot;addErrorMessage&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">addErrorMessage</span><span class="p">(</span><span class="n">full_msg</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="p">,</span> <span class="s2">&quot;addMessage&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">addMessage</span><span class="p">(</span><span class="n">full_msg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">full_msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_file_output</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_manager</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">log_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_manager</span><span class="o">.</span><span class="n">logs</span> <span class="o">/</span> <span class="s2">&quot;process_log.txt&quot;</span>
                <span class="n">log_file</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">log_file</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">full_msg</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="s2">&quot;warning&quot;</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ö†Ô∏è Could not write to log file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Avoid recursion</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not write to log file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="s2">&quot;error&quot;</span> <span class="ow">and</span> <span class="n">error_type</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">error_type</span><span class="p">(</span><span class="n">full_msg</span><span class="p">)</span></div>


<div class="viewcode-block" id="LogManager.debug">
<a class="viewcode-back" href="../../../api/managers.html#utils.manager.log_manager.LogManager.debug">[docs]</a>
    <span class="k">def</span> <span class="nf">debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span><span class="p">)</span></div>


<div class="viewcode-block" id="LogManager.info">
<a class="viewcode-back" href="../../../api/managers.html#utils.manager.log_manager.LogManager.info">[docs]</a>
    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;info&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span><span class="p">)</span></div>


<div class="viewcode-block" id="LogManager.warning">
<a class="viewcode-back" href="../../../api/managers.html#utils.manager.log_manager.LogManager.warning">[docs]</a>
    <span class="k">def</span> <span class="nf">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span><span class="p">)</span></div>


<div class="viewcode-block" id="LogManager.error">
<a class="viewcode-back" href="../../../api/managers.html#utils.manager.log_manager.LogManager.error">[docs]</a>
    <span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">error_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># If error_type is provided, always log at indent=0 unless overridden</span>
        <span class="n">use_indent</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">error_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">indent</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">indent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="n">use_indent</span><span class="p">,</span> <span class="n">error_type</span><span class="o">=</span><span class="n">error_type</span><span class="p">)</span></div>


<div class="viewcode-block" id="LogManager.success">
<a class="viewcode-back" href="../../../api/managers.html#utils.manager.log_manager.LogManager.success">[docs]</a>
    <span class="k">def</span> <span class="nf">success</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;success&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span><span class="p">)</span></div>


<div class="viewcode-block" id="LogManager.custom">
<a class="viewcode-back" href="../../../api/managers.html#utils.manager.log_manager.LogManager.custom">[docs]</a>
    <span class="k">def</span> <span class="nf">custom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">emoji</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;custom&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span><span class="p">,</span> <span class="n">emoji</span><span class="o">=</span><span class="n">emoji</span><span class="p">)</span></div>


    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_format_duration</span><span class="p">(</span><span class="n">seconds</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">mins</span><span class="p">,</span> <span class="n">secs</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">seconds</span><span class="p">),</span> <span class="mi">60</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mins</span><span class="si">}</span><span class="s2">m </span><span class="si">{</span><span class="n">secs</span><span class="si">}</span><span class="s2">s&quot;</span> <span class="k">if</span> <span class="n">mins</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">secs</span><span class="si">}</span><span class="s2">s&quot;</span>

<div class="viewcode-block" id="LogManager.get_messages">
<a class="viewcode-back" href="../../../api/managers.html#utils.manager.log_manager.LogManager.get_messages">[docs]</a>
    <span class="k">def</span> <span class="nf">get_messages</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">entries</span></div>


<div class="viewcode-block" id="LogManager.export_txt">
<a class="viewcode-back" href="../../../api/managers.html#utils.manager.log_manager.LogManager.export_txt">[docs]</a>
    <span class="k">def</span> <span class="nf">export_txt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;process_log.txt&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Export plain text log to .txt file.</span>

<span class="sd">        Args:</span>
<span class="sd">            filename (str): Output filename for the text log.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_manager</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;[LogManager] No PathManager available for export_txt().&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">txt_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_manager</span><span class="o">.</span><span class="n">logs</span> <span class="o">/</span> <span class="n">filename</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">txt_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">msg</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to write TXT log: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="LogManager.export_json">
<a class="viewcode-back" href="../../../api/managers.html#utils.manager.log_manager.LogManager.export_json">[docs]</a>
    <span class="k">def</span> <span class="nf">export_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;process_log.json&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Export log records to a structured JSON file.</span>

<span class="sd">        Args:</span>
<span class="sd">            filename (str): Filename for the JSON export.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_manager</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;[LogManager] No PathManager available for export_json().&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">json_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_manager</span><span class="o">.</span><span class="n">logs</span> <span class="o">/</span> <span class="n">filename</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">json_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to export JSON log: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="LogManager.export_html">
<a class="viewcode-back" href="../../../api/managers.html#utils.manager.log_manager.LogManager.export_html">[docs]</a>
    <span class="k">def</span> <span class="nf">export_html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;process_log.html&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Export log output to an HTML file with collapsible blocks.</span>

<span class="sd">        Args:</span>
<span class="sd">            filename (str): Output filename for the HTML log.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_manager</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;[LogManager] No PathManager available for export_html().&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">html_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_manager</span><span class="o">.</span><span class="n">logs</span> <span class="o">/</span> <span class="n">filename</span>
            <span class="n">html_path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># Ensure any open &lt;details&gt; is closed</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_open_details&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_details</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">html_blocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;/div&gt;&lt;/details&gt;&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_open_details</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">html_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">HTML_LOG_TEMPLATE_HEAD</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">html_blocks</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">HTML_LOG_TEMPLATE_FOOT</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to export HTML log: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="LogManager.export_all">
<a class="viewcode-back" href="../../../api/managers.html#utils.manager.log_manager.LogManager.export_all">[docs]</a>
    <span class="k">def</span> <span class="nf">export_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">basename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;process_log&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Export log to .txt, .html, and .json using a common base filename.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">export_txt</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">basename</span><span class="si">}</span><span class="s2">.txt&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">export_json</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">basename</span><span class="si">}</span><span class="s2">.json&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">export_html</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">basename</span><span class="si">}</span><span class="s2">.html&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="LogManager.step">
<a class="viewcode-back" href="../../../api/managers.html#utils.manager.log_manager.LogManager.step">[docs]</a>
    <span class="nd">@contextmanager</span>
    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Context manager for logging the start and end of a logical step.</span>
<span class="sd">        Logs separators before and after the step message at indent=0.</span>
<span class="sd">        Any log messages inside should use indent=1 for proper nesting.</span>
<span class="sd">        Usage:</span>
<span class="sd">            with logger.step(&quot;Run Mosaic Processor&quot;):</span>
<span class="sd">                logger.info(&quot;Hello&quot;, indent=1)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_context_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
        <span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">40</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">sep</span><span class="p">,</span> <span class="n">emoji</span><span class="o">=</span><span class="s2">&quot;‚ñ∂Ô∏è&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">emoji</span><span class="o">=</span><span class="s2">&quot;‚ñ∂Ô∏è&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">sep</span><span class="p">,</span> <span class="n">emoji</span><span class="o">=</span><span class="s2">&quot;‚ñ∂Ô∏è&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">yield</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
            <span class="n">elapsed_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_duration</span><span class="p">(</span><span class="n">elapsed</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2"> failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2"> (Elapsed: </span><span class="si">{</span><span class="n">elapsed_str</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">sep</span><span class="p">,</span> <span class="n">emoji</span><span class="o">=</span><span class="s2">&quot;‚ñ∂Ô∏è&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">raise</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
            <span class="n">elapsed_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_duration</span><span class="p">(</span><span class="n">elapsed</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2"> complete (Elapsed: </span><span class="si">{</span><span class="n">elapsed_str</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_context_stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span></div>
</div>



<span class="c1"># --- HTML Log Template Components ---</span>

<span class="n">HTML_LOG_TEMPLATE_HEAD</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">&lt;!DOCTYPE html&gt;</span>
<span class="s2">&lt;html&gt;&lt;head&gt;</span>
<span class="s2">&lt;meta charset=&quot;UTF-8&quot;&gt;</span>
<span class="s2">&lt;title&gt;Process Log&lt;/title&gt;</span>
<span class="s2">&lt;style&gt;</span>
<span class="s2">    body {</span>
<span class="s2">        font-family: &quot;Fira Code&quot;, Consolas, monospace;</span>
<span class="s2">        background-color: #ffffff;</span>
<span class="s2">        color: #222;</span>
<span class="s2">        padding: 2em;</span>
<span class="s2">        line-height: 1.6;</span>
<span class="s2">    }</span>
<span class="s2">    h1 {</span>
<span class="s2">        font-size: 1.8em;</span>
<span class="s2">        margin-bottom: 0.5em;</span>
<span class="s2">    }</span>
<span class="s2">    summary {</span>
<span class="s2">        font-weight: bold;</span>
<span class="s2">        font-size: 1.05em;</span>
<span class="s2">        cursor: pointer;</span>
<span class="s2">        margin-top: 1em;</span>
<span class="s2">        color: #333;</span>
<span class="s2">    }</span>
<span class="s2">    .ts {</span>
<span class="s2">        color: #888;</span>
<span class="s2">        font-size: 0.9em;</span>
<span class="s2">        display: inline-block;</span>
<span class="s2">        width: 180px;</span>
<span class="s2">        margin-right: 1em;</span>
<span class="s2">    }</span>
<span class="s2">    .info {</span>
<span class="s2">        color: #333;</span>
<span class="s2">    }</span>
<span class="s2">    .warning {</span>
<span class="s2">        color: #e65100;</span>
<span class="s2">        background-color: #fff8e1;</span>
<span class="s2">        padding: 2px 4px;</span>
<span class="s2">        border-left: 4px solid #f57c00;</span>
<span class="s2">    }</span>
<span class="s2">    .error {</span>
<span class="s2">        color: #b71c1c;</span>
<span class="s2">        background-color: #ffebee;</span>
<span class="s2">        padding: 2px 4px;</span>
<span class="s2">        border-left: 4px solid #d32f2f;</span>
<span class="s2">        font-weight: bold;</span>
<span class="s2">    }</span>
<span class="s2">    .debug {</span>
<span class="s2">        color: #777;</span>
<span class="s2">        font-style: italic;</span>
<span class="s2">    }</span>
<span class="s2">    .block {</span>
<span class="s2">        margin-left: 1.5em;</span>
<span class="s2">    }</span>
<span class="s2">    pre {</span>
<span class="s2">        white-space: pre-wrap;</span>
<span class="s2">    }</span>
<span class="s2">    label {</span>
<span class="s2">        font-size: 0.9em;</span>
<span class="s2">        display: block;</span>
<span class="s2">        margin-bottom: 1em;</span>
<span class="s2">        color: #444;</span>
<span class="s2">    }</span>
<span class="s2">&lt;/style&gt;</span>
<span class="s2">&lt;script&gt;</span>
<span class="s2">function toggleTimestamps() {</span>
<span class="s2">    const ts = document.querySelectorAll(&#39;.ts&#39;);</span>
<span class="s2">    ts.forEach(span =&gt; span.style.display = span.style.display === &#39;none&#39; ? &#39;inline-block&#39; : &#39;none&#39;);</span>
<span class="s2">}</span>
<span class="s2">&lt;/script&gt;</span>
<span class="s2">&lt;/head&gt;</span>
<span class="s2">&lt;body&gt;</span>
<span class="s2">&lt;h1&gt;üìÑ Process Log&lt;/h1&gt;</span>
<span class="s2">&lt;label&gt;&lt;input type=&quot;checkbox&quot; onclick=&quot;toggleTimestamps()&quot;&gt; Show/Hide Timestamps&lt;/label&gt;</span>
<span class="s2">&lt;hr&gt;</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">HTML_LOG_TEMPLATE_FOOT</span> <span class="o">=</span> <span class="s2">&quot;&lt;/body&gt;&lt;/html&gt;&quot;</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, RMI Valuation.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>